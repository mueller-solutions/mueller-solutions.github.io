---
import { useUserAgent } from 'astro-useragent';

type Props = astroHTML.JSX.ImgHTMLAttributes & {
  image: string;
  alt: string;
  width: number;
  height: number;
  preload?: boolean;
  format?: 'jpg' | 'webp' | 'avif' | 'png';
  noMobile?: boolean;
};

const { image, alt, class: className, preload = false, width, height, format = 'webp', noMobile = false } = Astro.props;

const uaString = Astro.request.headers.get('user-agent');
const { isMobile } = useUserAgent(uaString);

const imageName = !noMobile && isMobile ? `${image}_mobile` : image;
---

{preload && <link rel="preload" href={`/images/${imageName}.${format}`} as="image" type="image/webp" />}
<img
  src={`/images/${imageName}.${format}`}
  alt={alt}
  class={className}
  width={width}
  height={height}
  loading="lazy"
  decoding="async"
/>
